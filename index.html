<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DBA Noise Meter - Đo Độ Ồn</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css?v=2.0.6">
</head>

<body>
    <div id="app">
        <!-- Camera View -->
        <video id="camera" autoplay playsinline muted></video>

        <!-- Canvas for recording with overlay -->
        <canvas id="recordCanvas" style="display: none;"></canvas>

        <!-- Overlay -->
        <div id="overlay">
            <!-- DBA Display -->
            <div id="dba-container">
                <div id="dba-value">--</div>
                <div id="dba-label">dBA</div>
                <div id="dba-level">Đang khởi tạo...</div>
            </div>

            <!-- Audio Visualizer -->
            <canvas id="visualizer"></canvas>

            <!-- Info Display -->
            <div id="info-container">
                <div id="datetime"><i class="fa-regular fa-calendar"></i> <span id="datetime-text"></span></div>
                <div id="location"><i class="fa-solid fa-location-dot"></i> <span id="location-text">Đang lấy vị
                        trí...</span></div>
            </div>

            <!-- Recording Indicator -->
            <div id="recording-indicator" class="hidden">
                <span class="rec-dot"></span> REC
            </div>
        </div>

        <!-- Controls -->
        <div id="controls">
            <button id="btn-capture" title="Chụp ảnh">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="10" />
                </svg>
                <span>Chụp</span>
            </button>
            <button id="btn-record" title="Quay video">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="10" />
                </svg>
                <span>Quay</span>
            </button>
            <button id="btn-switch" title="Đổi camera">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z" />
                </svg>
                <span>Đổi</span>
            </button>
            <button id="btn-buy" title="Mua thiết bị">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM7.16 14.26l.94-2h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49-1.73-1L15.5 8H8.53l-.94-2H4v2h2l3.6 7.59-1.35 2.44c-.16.28-.25.61-.25.97 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.26-.24z" />
                </svg>
                <span>Thiết bị</span>
            </button>
        </div>

        <!-- Permission Modal -->
        <div id="permission-modal" class="modal">
            <div class="modal-content">
                <h2>Cần quyền truy cập</h2>
                <p>Ứng dụng cần quyền truy cập camera và microphone để đo độ ồn.</p>
                <button id="btn-grant">Cho phép truy cập</button>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="hidden"></div>
    </div>

    <script type="module" src="app.js?v=2.0.6"></script>
</body>

</html>